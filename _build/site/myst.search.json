{"version":"1","records":[{"hierarchy":{"lvl1":"About me"},"type":"lvl1","url":"/about-me","position":0},{"hierarchy":{"lvl1":"About me"},"content":":::{aside}\n```{image} images/propic.jpg\n:alt: propic\n:width: 160px\n```\n:::","type":"content","url":"/about-me","position":1},{"hierarchy":{"lvl1":"Welcome to SideHub"},"type":"lvl1","url":"/intro","position":0},{"hierarchy":{"lvl1":"Welcome to SideHub"},"content":"...and to be really sure you need to have a doubt\n\nHello! Welcome to this thing. I’m not sure what this is, but I created it with the intent to collect all my “side projects”, publish them in a single place, and making them available in the internet.\n\nDriven by a implacable curiosity, I am obsessed with creating mathematical models to describe the world around me, explore ideas, or solve doubts that pop up in my head. The model must be rigorously ab initio, namely from first principles. My end goal is, whether possible, to obtain analytical solutions. Modelling is a challenge that necessiates perseverance, but at the same time it stimulates deep thinking and sharpen your problem solving skills. Carefully choosing the approximations is in itself a real form of art: it requires creativity and imagination, as well as the skill to visualize your system and what you want to narrate through the model.\n\nNothing of what I’ve done is new, quite the opposite: I am obsessed with withdrawing in my shell and not looking anywhere for hints or solutions, except when strictly necessary. It won’t be surprising that most of the things you will read here are surely already well-known, and many interpretations inaccurate at best. This blog is not meant to be an enciclopedia, rather a collection of my thoughts, ideas, and obsessions. If I ever catch the interest of even one person in the world, I’ll be more than happy.\n\nPlease feel free to contact me for any feedback, suggestions, or corrections!\n\nMarco## Content of SideHub","type":"content","url":"/intro","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/dca","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/dca","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/continuous-return","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/continuous-return","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/equally-vs-mc-weighted","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/equally-vs-mc-weighted","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/index-funds","position":0},{"hierarchy":{"lvl1":""},"content":"Idea: see how the rise of index funds affects the market","type":"content","url":"/index-funds","position":1},{"hierarchy":{"lvl1":"Personal finance"},"type":"lvl1","url":"/intro-finance","position":0},{"hierarchy":{"lvl1":"Personal finance"},"content":"Idea: create an index of risk based on max drawdown vs boh\n Triggered by ep 200 of The Bull. Diversification prevents strong drawdowns, but also strong increases.Idea: simulate a set of investors with different properties that buy and sell stocks. The properties are e.g. risk tolerance, activeness, strategy. Then (ideally) simulate news that trigger buy and sells. Then see which one loses money, and which one gains it. It may be too complicated","type":"content","url":"/intro-finance","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/trading-tax-efficiency","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/trading-tax-efficiency","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/uv-index","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/uv-index","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/color-from-spectrum","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/color-from-spectrum","position":1},{"hierarchy":{"lvl1":"Physical modelling"},"type":"lvl1","url":"/intro-physics","position":0},{"hierarchy":{"lvl1":"Physical modelling"},"content":"Here we discuss about physical modelling.\n\nAtmospheric pressure","type":"content","url":"/intro-physics","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/planet-orbits","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/planet-orbits","position":1},{"hierarchy":{"lvl1":"Atmospheric pressure"},"type":"lvl1","url":"/pressure","position":0},{"hierarchy":{"lvl1":"Atmospheric pressure"},"content":"Beware scientists!\n\nHere reported is an ab initio modelling project. You will find many mistakes, errors, and inaccuracies because I like to do things by myself, often without looking for solutions or explanations. My projects are the opposite of standing on the shoulders of giants. They are like trying to build my own giant, and he’s barely alive.```{embed} #abinitio-warning\n```\n\nPreface\n\nI did this project in Desmos back in 2021. For some reason, I’ve always been obsessed with air pressure, perhaps because I discovered that it can be measured outstandingly precisely with a smartphone. It can even detect altitude changes on the order of meters. So I asked myself: can I derive how the atmospheric pressure varies with altitude, and can I do it as accurately as possible? This way, I could estimate a change in altitude by measuring the change in pressure with my phone. And it seems to work rather nicely. Follow me through it and you’ll see.","type":"content","url":"/pressure","position":1},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Introduction"},"type":"lvl2","url":"/pressure#introduction","position":2},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Introduction"},"content":"In this chapter, we will try to find, in an ab initio manner, how atmospheric pressure and altitude are related to each other.","type":"content","url":"/pressure#introduction","position":3},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"The barometric formula"},"type":"lvl2","url":"/pressure#heading-barometric-formula","position":4},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"The barometric formula"},"content":"We start from considering an ideal gas. This approximation works well with the Earth’s atmosphere, because it has a sufficiently low density and high temperature. From the ideal gas law, the pressure is given by:p=nk_BT\n\nwhere n the numerical density of the gas, and T its temperature. To model Earth’s atmosphere, we imagine an infinitely high column of gas subjected to Earth’s gravitational field. For now, we assume that Earth is spherically symmetric. The pressure of the gas at a certain altitude h must be equivalent to the pressure exerted by the column of gas above it, due to the gravitational field, i.e.:nk_BT(h) = p(h)=\\dfrac{F(h)}{A}\n\nwith F the weight of the gas column above h, which is given by the integral along the vertical direction z of the mass density \\rho(z) of the gas, times the gravity g(z):p(h) = \\int_h^{+\\infty}g(z)\\rho(z) dz  = \\int_h^{+\\infty}g(z)m_0(z)n(z) dz\n\nwhere we expressed the mass density ρ as the product of the average mass of the gas particle, m_0, and the numerical density, n. We can rearrange and convert the equation in its differential form, knowing that n(+\\infty)=0:\\dfrac{d}{dh}p(h)=-g(h)\\,m_0(h)n(h) = -g(h)\\,m_0(h)\\dfrac{p(h)}{k_BT(h)}\n\nWhere we used equation \n\n(1) to express the numerical density in terms of density and temperature. Note that equation \n\n(4) only depends on the altitude h and its proximity (the derivative), and not on the whole gas column that sits above. This mathematical step permits us to reach for a solution, but at the cost of not being able to find the absolute value of the pressure. Rearranging equation \n\n(4), we have:\\dfrac{\\dfrac{d}{dh}p(h)}{p(h)}=-\\dfrac{1}{k_B}\\dfrac{g(h)m_0(h)}{T(h)}\n\nBy integrating in dz from 0 to h we eventually obtain the general solution of how the pressure varies with the altitude:p(h)=p(0)\\exp\\bigg[-\\dfrac{1}{k_B}\\int_0^h\\dfrac{g(z)m_0(z)}{T(z)}dz\\bigg]\n\nWhere p(0), the pressure at h=0, is not known and must be obtained from the observed data. If we choose h=0 to be the sea level, then p(0) is the barometric pressure, which in standard conditions is 1013.25\\ \\mathrm{hPa}. We will understand how temperature and average mass vary with altitude in the following section. For now, let’s find the simplest solution by assuming that are all variables inside the integral, i.e. composition, temperature, and gravity, are constants. Such approximation is valid close to the Earth’s surface level. We then obtain:p(h)=p(0)\\exp\\bigg[-\\dfrac{m_0gh}{k_BT}\\bigg]\n\nWe recognize m_0gh as the potential energy of a single gas particle, and k_BT as its thermal energy. Wait, what? Equation \n\n(7) is called the barometric formula. The exponential term is the Boltzmann factor (e^{-E/k_BT}), which, in a canonical ensemble (NVT, our case), represents the probability of the system to be in a state with energy E. In our case, E is the potential energy of a mass in a uniform gravitational field, and the Boltzmann factor represents the probability of a particle to be at that altitude. Macroscopically, this becomes the actual pressure of the gas.","type":"content","url":"/pressure#heading-barometric-formula","position":5},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Adding lapse rates"},"type":"lvl2","url":"/pressure#adding-lapse-rates","position":6},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Adding lapse rates"},"content":"Reference atmospheric models\n\nThe International Standard Atmosphere (ISA) is a model that describes how the atmospheric parameters change with altitude. It assumes a constant gravitational field, dry air, and it divides the atmosphere is various layers, with different characteristics.","type":"content","url":"/pressure#adding-lapse-rates","position":7},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl3":"Geopotential altitude","lvl2":"Adding lapse rates"},"type":"lvl3","url":"/pressure#geopotential-altitude","position":8},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl3":"Geopotential altitude","lvl2":"Adding lapse rates"},"content":"The vertical distance from the Earth’s mean sea level (MSL) is called the geometric altitude. In aviation and meteorology, the geopotential altitude is used instead, and it is defined as:\n\nGeopotential altitude\n\nThe vertical coordinate referenced to Earth’s MSL that represents the work performed when lifting one unit of mass over one unit of length through a hypothetical space in which the acceleration of gravity is assumed to be constant.\n\nAs you may know, Earth’s gravitational field changes not only with altitude but also with the latitude and, to a minor extent, longitude. The geopotential altitude arises when assuming a constant gravitational field with g_0=9.80665\\ \\mathrm{m/s^2}, the standard gravity at MSL, and it is related to potential energy, E=mg_0h. Specifically, a geopotential difference of 1\\ \\mathrm{m} corresponds to a potential energy difference of 9.80665\\ \\mathrm{J}. For example, on the North Pole, where g_{np}>g_0, a geometric height of 1\\ \\mathrm{m} corresponds to a geopotential altitude that is larger than one meter:mg_0h_{geop} = mg_{np}h_{geom} \\implies h_{geop} = \\dfrac{g_{np}}{g_{0}}h_{geom} > h_{geom}\n\nMore rigorously, denoting Earth’s radius with R, the geopotential height h is related to the geometric height z according to the formula:h = \\dfrac{R}{R+z}\\,z\n\nThe geopotential altitude is the one that we used in the section \n\nThe barometric formula, where we assumed g constant. We will get rid of this approximation in a later section.","type":"content","url":"/pressure#geopotential-altitude","position":9},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl3":"Temperature","lvl2":"Adding lapse rates"},"type":"lvl3","url":"/pressure#temperature","position":10},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl3":"Temperature","lvl2":"Adding lapse rates"},"content":"The atmospheric temperature depends on many factors, such as irradiation from Earth’s surface, convection, chemical reactions, and interaction with high-energy photons from the Sun. The variation of temperature with altitude is called lapse rate, Γ:\\Gamma = -\\dfrac{dT}{dh}\n\nThe dry air approximation gives the dry adiabatic lapse rate (DALR. \\Gamma_d):\\Gamma_d = \\dfrac{g}{c_p} = 9.8\\ ^\\circ\\mathrm{C/km}\n\nwhich is valid only at the vicinity of Earth’s surface. The ISA provides a set of empirical lapse rates for each atmospheric layer. Starting from a temperature of 15°C (288.15 K) at MSL:\n\nTroposphere (0-11 km): 6.5 °C/km\n\nTropopause (11-20 km): 0.0 °C/km\n\nStratosphere (20-32 km): 1.0 °C/km\n\nStratosphere (32-47 km): -2.8 °C/km\n\nStratopause (47-51 km): 0.0 °C/km\n\nMesosphere (51-71 km): 2.8 °C/km\n\nMesosphere (71-84.852 km): 2.0 °C/km\n\nThere are other layers above, but can be ignored since the atmosphere is extremely rarefied. The ranges are given in geopotential altitude.","type":"content","url":"/pressure#temperature","position":11},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl3":"Chemical composition","lvl2":"Adding lapse rates"},"type":"lvl3","url":"/pressure#subheading-chemical-composition","position":12},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl3":"Chemical composition","lvl2":"Adding lapse rates"},"content":"The composition of the dry atmosphere is kindly provided by the \n\nNOAA. However, the molar fractions they provide sum to more than one, due to experimental error (as also \n\nwikipedia reports). While looking for the most precise values, I noticed an incongruence in the reported amount of \\mathrm{CO_2}. I quickly realized a shocking fact: the atmospheric concentration of \\mathrm{CO_2} is rising so quickly that most values are now outdated. For example, \n\nengineering toolbox uses a value of f_{CO_2}=0.033\\%, which is the fraction from circa 50 years ago (in the '70s). The value is now (2025) 0.042\\%, giving an outstanding 27% increase. This makes me wonder whether NOAA takes into account the change in fractional concentrations due to \\mathrm{CO_2} emissions and \\mathrm{O_2} depletion. A strong hint is that by substituting the present \\mathrm{CO_2} concentration with 0.033\\% in NOAA’s value, the sum magically becomes 1. For this reason, I took NOAA’s value and assumed that the 0.011\\% increase is due to combustion, and it substitutes \\mathrm{O_2} moleculesf_{CO_2}(2004) = 0.033\\% &\\longrightarrow f_{CO_2}(2025) = 0.042\\% \\\\\nf_{O_2}(2004) = 20.946\\% &\\longrightarrow f_{O_2}(2025) = 20.937\\%\n\nThis, however, results from the crude approximation that the additional carbon dioxide has been produced by a stoichiometric reaction between atmospheric oxygen and carbon, while all other species stay constant. In reality, $\\mathrm{CO}_2 production is less “efficient”, because of the formation of water, among other compounds.\n\nTable 1:Chemical composition of Earth’s dry atmosphere, modified data from \n\nNOAA to sum to one. In the ideal gas approximation, mole fractions and volume fractions are equivalent.\n\nElement\n\nmole fraction\n\nN2\n\n78.084%\n\nO2\n\n20.937%\n\nAr\n\n0.934%\n\nCO2\n\n0.042%\n\nNe\n\n18.182 ppm\n\nHe\n\n5.24 ppm\n\nCH4\n\n1.92 ppm\n\nKr\n\n1.14 ppm\n\nH2\n\n0.55 ppm\n\nN2O\n\n0.33 ppm\n\nCO\n\n0.10 ppm\n\nXe\n\n0.09 ppm\n\nO3\n\n0.07 ppm\n\nNO2\n\n0.02 ppm\n\nI2\n\n0.01 ppm\n\nother\n\ntraces\n\nWhich gives an average molar mass m = 28.9656\\ \\mathrm{g/mol}. The value is higher compared to 28.9647\\ \\mathrm{g/mol} encountered online, obtained from a lower level of atmospheric \\mathrm{CO_2} of 332 ppm. However, my calculation might be too rough, or blatantly wrong; I’m not too sure. See the \n\nScripps FAQ page for additional information.\n\nOf course, the atmosphere is never dry. Local concentrations of water vapor range from 0% to 4%. The molar fractions, including humidity, are simply given byf_{A}^{(hum)}=\\big(1-f_{H_2O}\\big)\\cdot f_{A}^{(dry)}\n\nwith A any species.\n\nQuick proof\n\nIn the dry case it holds\\sum_A f_{A}^{(dry)} = 1\n\nwhile for humid airf_{H_2O} + \\sum_A f_{A}^{(hum)} = 1\n\nWhen water vapor is added to the dry air, all f_{A}^{(dry)} must decrease by the same multiplying factor k:f_{H_2O} + k\\sum_A f_{A}^{(dry)} &= 1 \\\\\nf_{H_2O} + k &= 1  \\\\\nk &= 1-f_{H_2O}\n\nwhich gives equation \n\n(13).\n\nAccording to the \n\nNRLMSIS empirical model, Earth’s atmospheric composition remains rather constant up to h\\approx 80\\ \\mathrm{km}. This is due to diffusion and turbulent convection, resulting in a well-mixing of the various gases. This is true up to a certain altitude\n\nLet’s start from the barometric formula \n\n(7) and remove approximations one by one to finally arrive at the general formula \n\n(6). First, we introduce the empirical lapse rates that we learned above. We thus leave only the temperature term in the integral:p(h)=p(0)\\exp\\bigg[-\\dfrac{gm}{R}\\int_0^h\\dfrac{1}{T(z)}dz\\bigg]\n\nWhere we used the average molar mass m and the gas constant R instead of m_0 and k_B.\nNow the temperature can be written as the general expression:T(h)= T(h_{i}) - \\Gamma_i (h-h_{i})\n\nwith i the atmospheric layer in which h lies, and h_{i} the base altitude of the layer i. This however can be easily calculated with a simple code. Let’s import the packages.\n\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom scipy.integrate import quad\n\nand define a function that returns the temperature at a certain altitude, using equation \n\n(18) for each layer.\n\ndef temperature(altitude):\n    # Define base altitudes and temperatures for each layer\n    T0= 288.15  # MSL standard temperature in Kelvin\n    base_altitudes = [0, 11000, 20000, 32000, 47000, 51000, 71000, 84852]\n    lapse_rates = [0.0065, 0.0, -0.001, -0.0028, 0.0, 0.0028, 0.002, 0.0]\n\n    temperature = T0  \n\n    # Find the layer corresponding to the altitude\n    for i in range(len(base_altitudes) - 1):\n        if altitude <= base_altitudes[i+1]:\n            return temperature - lapse_rates[i] * (altitude - base_altitudes[i])\n        else:\n            temperature = temperature - lapse_rates[i] * (base_altitudes[i+1]-base_altitudes[i])\n\n    # If altitude is above the highest defined layer\n    return temperature\n\n# Generate altitudes from 0 to 85 km and calculate temperature\naltitudes = np.linspace(0, 85, 500)\ntemperatures = [temperature(1000*alt) for alt in altitudes]\n\nplt.rcParams.update({'font.size': 9})\nplt.figure(figsize=(7, 3))\nplt.plot(altitudes, temperatures, color=\"darkred\",lw=2)\nplt.xlabel(\"Altitude (m)\")\nplt.ylabel(\"Temperature (K)\")\nplt.grid(True)\nplt.show()\n\nNow we can define a function to calculate the pressure, which contains the evaluation of the integral of 1/T.\n\ndef pressure(altitude):\n    R = 8.31446  # Specific gas constant for dry air in J/(mol·K)\n    g = 9.80665  # Standard gravity in m/s^2\n    m = 28.9656e-3  # Molar mass of air in kg/mol\n    P0 = 101325  # MSL standard atmospheric pressure in Pa\n\n    integral, err = quad(lambda h: 1 / temperature(h), 0, altitude, limit=100, points=[0, 11000, 20000, 32000, 47000, 51000, 71000, 84852])\n    pressure = P0 * np.exp(-m*g/R * integral)\n\n    return pressure\n\nThis results in a fair estimation of the pressure with altitude.\n\naltitudes = np.linspace(0, 85, 500)\npressures = [pressure(1000*alt) for alt in altitudes]\nplt.rcParams.update({'font.size': 9})\nplt.figure(figsize=(8, 4))\nplt.plot(altitudes, pressures, color=\"black\",lw=2)\nplt.xlabel(\"Altitude (km)\")\nplt.ylabel(\"Pressure (Pa)\")\nplt.grid(True)\nplt.show()\n\n","type":"content","url":"/pressure#subheading-chemical-composition","position":13},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Adding variation of chemical composition"},"type":"lvl2","url":"/pressure#adding-variation-of-chemical-composition","position":14},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Adding variation of chemical composition"},"content":"The value that we calculated in \n\nChemical composition refers to the global average of the atmospheric composition. We are now interested in how such composition changes with altitude. We know that turbulence and diffusion make the atmospheric composition rather constant up to 80 km (\n\nFigure 1). The vertical profile of carbon dioxide, one of the heaviest molecules in the air, starts decreasing from an altitude of 60 km.\n\n\n\nFigure 1:Atmospheric composition vs altitude\n\n\n\nFigure 2:Altitude profile of \\mathrm{CO}_2 molar fraction, in ppm. From \n\nBrown et al. (2024).\n\nThe \n\nNRLMSIS empirical model provides an enormous quantity of data , that ...","type":"content","url":"/pressure#adding-variation-of-chemical-composition","position":15},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Altitude from pressure"},"type":"lvl2","url":"/pressure#altitude-from-pressure","position":16},{"hierarchy":{"lvl1":"Atmospheric pressure","lvl2":"Altitude from pressure"},"content":"Take equation T_from lapse and solve it with T = T(0)-Lz or T(h)-Lh-Lz and rearrange","type":"content","url":"/pressure#altitude-from-pressure","position":17},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/radiation","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/radiation","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/spotlight","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/spotlight","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/sun-position","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/sun-position","position":1},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/tools","position":0},{"hierarchy":{"lvl1":""},"content":"","type":"content","url":"/tools","position":1}]}